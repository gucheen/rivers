{"version":3,"sources":["sw.ts","loaders.ts","queue.ts","quries.ts"],"names":[],"mappings":"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","file":"","sourcesContent":["import { TaskLoaders } from './loaders';\nimport { Task } from './models';\n\nconst loaders = new TaskLoaders();\n\nself.addEventListener(\"install\", (event) => {\n    console.log(loaders.queue.getCount());\n});\n\nself.addEventListener(\"message\", (event) => {\n    console.log(event);\n\n    const task: Task = event.data;\n\n    loaders.queue.enqueue(task);\n\n    loaders.store[task.query] = [];\n\n    loaders.processNext();\n});","class LoaderData {\n    constructor(name: string) { };\n}\n\ninterface Loaders {\n    queue: Queue;\n\n    loadData(task: Task): any;\n    processNext(): void;\n}\n\nimport { Task } from './models';\nimport { Queue } from './queue';\nimport { Quries } from './quries';\n\nexport class TaskLoaders implements Loaders {\n    queue = new Queue();\n    store: { [index: string]: any[] } = {};\n\n    constructor() {\n    }\n\n    loadData(task: Task) {\n        const queryFunc = Quries[task.query];\n        return queryFunc({\n            limit: 100,\n            offset: 0,\n        });\n    }\n\n    processNext() {\n        const task = this.queue.dequeue();\n        const data = this.loadData(task)\n            .then(data => {\n                this.store[task.query].push(data);\n                console.log(this.store);\n            });\n    }\n}","class ExtendArray {\n    isEmpty(arr: any[]): boolean {\n        return arr.length === 0;\n    }\n\n    peek(array: any[]): any {\n        return array[array.length - 1];\n    }\n\n    contains(arr: any[], obj: any): boolean {\n        return arr.indexOf(obj) >= 0;\n    }\n\n    remove(arr: any[], obj: any): boolean {\n        const i = arr.indexOf(obj);\n        let rv;\n        if ((rv = i >= 0)) {\n            arr.splice(i, 1);\n        }\n        return rv;\n    }\n\n    removeLast(arr: any[], obj: any): boolean {\n        var i = arr.lastIndexOf(obj);\n        if (i >= 0) {\n            arr.splice(i, 1);\n            return true;\n        }\n        return false;\n    }\n}\n\nexport class Queue {\n    private extendArray = new ExtendArray();\n    private front: any[] = [];\n    private back: any[] = [];\n\n    private maybeFlip() {\n        if (this.front.length === 0) {\n            this.front = this.back;\n            this.front.reverse();\n            this.back = [];\n        }\n    }\n\n    enqueue(element: any) {\n        this.back.push(element);\n    }\n\n    dequeue(): any {\n        this.maybeFlip();\n        return this.front.pop();\n    }\n\n    peek(): any {\n        this.maybeFlip();\n        return this.extendArray.peek(this.front);\n    }\n\n    getCount(): number {\n        return this.front.length + this.back.length;\n    }\n\n    isEmpty(): boolean {\n        return this.extendArray.isEmpty(this.front) && this.extendArray.isEmpty(this.back);\n    }\n\n    clear() {\n        this.front = [];\n        this.back = [];\n    }\n\n    contains(obj: any): boolean {\n        return this.extendArray.contains(this.front, obj) ||\n            this.extendArray.contains(this.back, obj);\n    }\n\n    remove(obj: any): boolean {\n        return this.extendArray.removeLast(this.front, obj) ||\n            this.extendArray.remove(this.back, obj);\n    }\n\n    getValues() {\n        const res = [];\n        // Add the front array in reverse, then the back array.\n        for (let i = this.front.length - 1; i >= 0; --i) {\n            res.push(this.front[i]);\n        }\n        const len = this.back.length;\n        for (var i = 0; i < len; ++i) {\n            res.push(this.back[i]);\n        }\n        return res;\n    }\n}","interface Pagination {\n    limit: number;\n    offset: number;\n}\n\ninterface MethodCollections {\n    [methodName: string]: (pagination: Pagination) => Promise<any>\n}\n\nexport const Quries: MethodCollections = {\n    test: (pagination: Pagination) => {\n        return new Promise((resolve, reject) => {\n            setTimeout(() => {\n                resolve({\n                    page: {\n                        total: 100,\n                        limit: pagination.limit,\n                        offset: pagination.offset,\n                    },\n                    data: [\n                        {\n                            id: 1,\n                        },\n                        {\n                            id: 2,\n                        },\n                    ],\n                });\n            }, 500);\n        });\n    } \n}"]}